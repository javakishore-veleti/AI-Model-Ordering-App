@inject ToastService ToastService

<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;">
    @foreach (var toast in toasts)
    {
        <div class="toast show fade shadow-lg mb-3 animate__animated animate__fadeInDown"
             style="min-width: 300px;"
             @onclick="() => RemoveToast(toast)">

            <div class="toast-header @HeaderClass(toast.Type)">
                <strong class="me-auto">@toast.Title</strong>
                <button type="button" class="btn-close" @onclick="() => RemoveToast(toast)"></button>
            </div>

            <div class="toast-body">
                @toast.Message

                <div class="progress mt-2" style="height: 4px;">
                    <div class="progress-bar @ProgressClass(toast.Type)"
                         role="progressbar"
                         style="width: 100%; animation: shrink @((toast.Duration / 1000.0))s linear forwards;">
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@code {
    private List<ToastMessage> toasts = new();

    protected override void OnInitialized()
    {
        ToastService.OnShow += AddToast;
        ToastService.OnHide += RemoveToast;
    }

    private void AddToast(ToastMessage toast)
    {
        toasts.Add(toast);
        InvokeAsync(StateHasChanged);
    }

    private void RemoveToast(ToastMessage toast)
    {
        toasts.Remove(toast);
        InvokeAsync(StateHasChanged);
    }

    string HeaderClass(ToastType type) =>
        type switch
        {
            ToastType.Success => "bg-success text-white",
            ToastType.Error => "bg-danger text-white",
            ToastType.Warning => "bg-warning text-dark",
            _ => "bg-primary text-white"
        };

    string ProgressClass(ToastType type) =>
        type switch
        {
            ToastType.Success => "bg-success",
            ToastType.Error => "bg-danger",
            ToastType.Warning => "bg-warning",
            _ => "bg-primary"
        };
}
